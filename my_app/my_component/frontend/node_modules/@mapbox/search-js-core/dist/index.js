var Ee=Object.create;var P=Object.defineProperty,xe=Object.defineProperties,_e=Object.getOwnPropertyDescriptor,Oe=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,Pe=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var te=(n,e,t)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,a=(n,e)=>{for(var t in e||(e={}))W.call(e,t)&&te(n,t,e[t]);if(j)for(var t of j(e))ne.call(e,t)&&te(n,t,e[t]);return n},b=(n,e)=>xe(n,Oe(e)),se=n=>P(n,"__esModule",{value:!0});var q=(n,e)=>{var t={};for(var s in n)W.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&j)for(var s of j(n))e.indexOf(s)<0&&ne.call(n,s)&&(t[s]=n[s]);return t};var Ue=(n,e)=>{for(var t in e)P(n,t,{get:e[t],enumerable:!0})},re=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ae(e))!W.call(n,r)&&(t||r!=="default")&&P(n,r,{get:()=>e[r],enumerable:!(s=_e(e,r))||s.enumerable});return n},Fe=(n,e)=>re(se(P(n!=null?Ee(Pe(n)):{},"default",!e&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),Ne=(n=>(e,t)=>n&&n.get(e)||(t=re(se({}),e,1),n&&n.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var M=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var l=(n,e,t)=>(M(n,e,"read from private field"),t?t.call(n):e.get(n)),m=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},p=(n,e,t,s)=>(M(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),oe=(n,e,t,s)=>({set _(r){p(n,e,r,t)},get _(){return l(n,e,s)}}),T=(n,e,t)=>(M(n,e,"access private method"),t);var d=(n,e,t)=>new Promise((s,r)=>{var o=i=>{try{c(t.next(i))}catch(h){r(h)}},g=i=>{try{c(t.throw(i))}catch(h){r(h)}},c=i=>i.done?s(i.value):Promise.resolve(i.value).then(o,g);c((t=t.apply(n,e)).next())});var Ke={};Ue(Ke,{AutofillMatchCodeConfidence:()=>z,Evented:()=>I,LngLat:()=>u,LngLatBounds:()=>S,MapboxAutofill:()=>G,MapboxError:()=>C,MapboxSearch:()=>D,SearchSession:()=>ee,SessionToken:()=>f,featureToSuggestion:()=>ve,polyfillFetch:()=>Q});var E="https://api.mapbox.com/search/v1",J="suggest",H="retrieve",ie="forward",ae="reverse",ge=`${E}/${J}`,ue=`${E}/${H}`,ce=`${E}/${ie}`,le=`${E}/permanent/${ie}`,fe=`${E}/${ae}`,me=`${E}/permanent/${ae}`;var u=class{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(e){if(e instanceof u)return new u(e.lng,e.lat);if(Array.isArray(e)&&e.length===2)return new u(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null&&("lng"in e||"lon"in e)&&"lat"in e)return new u(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};var S=class{constructor(e,t){this._sw=u.convert(e),this._ne=u.convert(t)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u(this.getWest(),this.getNorth())}getSouthEast(){return new u(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(e){if(!e)throw new Error("Invalid LngLatBounds convert value: falsy");if(e instanceof S)return new S(e.getSouthWest(),e.getNorthEast());if(Array.isArray(e)&&e.length===2)return new S(u.convert(e[0]),u.convert(e[1]));if(Array.isArray(e)&&e.length===4)return new S(u.convert([e[0],e[1]]),u.convert([e[2],e[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};var he=Fe(require("polyfill-crypto.getrandomvalues"));function Ie(n){return typeof globalThis.crypto=="undefined"||typeof globalThis.crypto.getRandomValues!="function"?(0,he.default)(n):globalThis.crypto.getRandomValues(n)}function $e(n){let e=[...n].map(t=>{let s=t.toString(16);return t<16?"0"+s:s});return[...e.slice(0,4),"-",...e.slice(4,6),"-",...e.slice(6,8),"-",...e.slice(8,10),"-",...e.slice(10,16)].join("")}function pe(){let n=Ie(new Uint8Array(16));return n[6]=n[6]&15|64,n[8]=n[8]&63|128,$e(n)}var je=60*60*1e3,f=class{constructor(e,t=Date.now()){this.id=e!=null?e:pe(),this.ts=t}toString(){return this.id}static convert(e){return new f(e instanceof f?e.id:e.toString(),e instanceof f?e.ts:Date.now())}isExpired(){return Date.now()-this.ts>je}};var qe="Unknown error",C=class extends Error{constructor(e,t){super(String(e.message||e.error||qe));this.name="MapboxError",this.statusCode=t}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function y(n){return d(this,null,function*(){if(!n.ok){let e=yield n.json();throw new C(e,n.status)}})}var U=globalThis.fetch,Se=globalThis.AbortController;function Q({fetch:n,AbortController:e},t=!1){if(!n)throw new Error("Fetch implementation must include implementations of `fetch`.");U&&!t||(U=n,Se=e)}function R(){if(!U)throw new Error("Fetch implementation not found. Please use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:U,AbortController:Se}}function de(n,e){return n(e)}if(!U&&!0&&process.versions.node){let{default:n}=de(require,"node-fetch"),e=de(require,"abort-controller");Q({fetch:n,AbortController:e})}function x(...n){let e=[];for(let t of n){if(!t)continue;let s=Object.entries(t);for(let[r,o]of s)o!=null&&e.push(`${r}=${encodeURIComponent(String(o))}`)}return e.join("&")}var F,be,V,Ce,X=class{constructor(e={}){m(this,F);m(this,V);let r=e,{accessToken:t}=r,s=q(r,["accessToken"]);this.accessToken=t,this.defaults=a(a({},X.defaults),s)}suggest(e,t){return d(this,null,function*(){if(!e)throw new Error("searchText is required");if(!this.accessToken)throw new Error("accessToken is required");if(!t||!t.sessionToken)throw new Error("sessionToken is required");let{sessionToken:s,signal:r}=t,o=b(a(a({},this.defaults),t),{sessionToken:s});if(o.eta_type&&(!o.origin||!o.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(o.origin&&!o.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");let g=new URL(`${ge}/${encodeURIComponent(e)}`);g.search=T(this,F,be).call(this,o);let{fetch:c}=R(),i=yield c(g.toString(),{signal:r});return yield y(i),yield i.json()})}retrieve(e,t){return d(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.accessToken)throw new Error("accessToken is required");if(!this.canRetrieve(e))throw new Error("suggestion cannot be retrieved");if(!t||!t.sessionToken)throw new Error("sessionToken is required");let{sessionToken:s,signal:r}=t,o=f.convert(s),g=new URL(ue);g.search=x({access_token:this.accessToken,session_token:o.id});let{fetch:c}=R(),i=yield c(g.toString(),b(a({},T(this,V,Ce).call(this,e)),{signal:r}));return yield y(i),yield i.json()})}canRetrieve(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===H:!1}canSuggest(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===J:!1}forward(s){return d(this,arguments,function*(e,t={}){if(!e)throw new Error("searchText is required");if(!this.accessToken)throw new Error("accessToken is required");let r=a(a({},this.defaults),t),o=r.permanent?le:ce,g=new URL(`${o}/${encodeURIComponent(e)}`);g.search=T(this,F,be).call(this,r);let{fetch:c}=R(),i=yield c(g.toString(),{signal:r.signal});return yield y(i),yield i.json()})}reverse(s){return d(this,arguments,function*(e,t={}){if(!e)throw new Error("lngLat is required");if(!this.accessToken)throw new Error("accessToken is required");let r=a(a({},this.defaults),t),o=typeof e=="string"?e:u.convert(e).toArray().join(","),g=r.permanent?me:fe,c=new URL(`${g}/${encodeURIComponent(o)}`);c.search=x({access_token:this.accessToken,language:r.language,limit:r.limit},r.types&&{types:typeof r.types=="string"?r.types:[...r.types].join(",")});let{fetch:i}=R(),h=yield i(c.toString(),{signal:r.signal});return yield y(h),yield h.json()})}},D=X;F=new WeakSet,be=function(e){return x({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit,navigation_profile:e.navigation_profile,eta_type:e.eta_type},e.sessionToken&&{session_token:f.convert(e.sessionToken).id},e.origin&&{origin:typeof e.origin=="string"?e.origin:u.convert(e.origin).toArray().join(",")},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:S.convert(e.bbox).toFlatArray().join(",")},e.types&&{types:typeof e.types=="string"?e.types:[...e.types].join(",")})},V=new WeakSet,Ce=function(e){if(!this.canRetrieve(e)&&!this.canSuggest(e))throw new Error("Suggestion cannot be retrieved or suggested");let t=e.action,s=JSON.stringify(t.body);return{method:t.method,body:s,headers:{"Content-Type":"application/json","Content-Length":s.length.toString()}}},D.defaults={language:"en"};var Re="https://api.mapbox.com/autofill/v1",De="suggest",Ve="retrieve",Le=`${Re}/${De}`,Te=`${Re}/${Ve}`;var N,ke,Y=class{constructor(e={}){m(this,N);let r=e,{accessToken:t}=r,s=q(r,["accessToken"]);this.accessToken=t,this.defaults=a(a({},Y.defaults),s)}suggest(e,t){return d(this,null,function*(){if(!e)throw new Error("searchText is required");if(!this.accessToken)throw new Error("accessToken is required");if(!t||!t.sessionToken)throw new Error("sessionToken is required");let{sessionToken:s,signal:r}=t,o=b(a(a({},this.defaults),t),{sessionToken:s}),g=new URL(`${Le}/${encodeURIComponent(e)}`);g.search=T(this,N,ke).call(this,o);let{fetch:c}=R(),i=yield c(g.toString(),{signal:r});yield y(i);let h=yield i.json();return b(a({},h),{suggestions:h.suggestions.map(A=>b(a({},A),{original_search_text:e}))})})}retrieve(e,t){return d(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.accessToken)throw new Error("accessToken is required");if(!t||!t.sessionToken)throw new Error("sessionToken is required");let{sessionToken:s,signal:r}=t,o=b(a(a({},this.defaults),t),{sessionToken:s}),g=typeof e!="string",c=g?e.original_search_text:e,i=new URL(`${Te}/${encodeURIComponent(c)}`);i.search=T(this,N,ke).call(this,o);let{fetch:h}=R(),A=yield h(i.toString(),{signal:r});yield y(A);let K=yield A.json();return g?b(a({},K),{features:K.features.filter(we=>we.properties.full_address===e.full_address)}):K})}},G=Y;N=new WeakSet,ke=function(e){return x({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit},e.sessionToken&&{session_token:f.convert(e.sessionToken).id},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:S.convert(e.bbox).toFlatArray().join(",")})},G.defaults={language:"en",proximity:"ip"};var z=(r=>(r.exact="exact",r.high="high",r.medium="medium",r.low="low",r))(z||{});var _,I=class{constructor(){m(this,_,{})}addEventListener(e,t){let s=l(this,_);s[e]||(s[e]=[]),s[e].push(t)}removeEventListener(e,t){let s=l(this,_);if(!s[e])return;let r=s[e],o=r.indexOf(t);o!==-1&&r.splice(o,1)}fire(e,t){let s=l(this,_);if(!s[e])return;let r=s[e];for(let o of r)o(t)}};_=new WeakMap;function ye(n,e,t){let s=null;return(...r)=>{s!==null&&clearTimeout(s);let o=t&&t();s=setTimeout(()=>{s=null,!(o==null?void 0:o.aborted)&&n(...r)},e)}}var Ge=50;function Z(){let{AbortController:n}=R();return new n}var O,L,v,B,Be,w,k,$,ee=class extends I{constructor(e,t=0){super();m(this,B);m(this,O,!1);m(this,L,new f);m(this,v,0);m(this,w,void 0);m(this,k,Z());m(this,$,void 0);p(this,$,ye((o,...g)=>d(this,[o,...g],function*(s,r={}){if(l(this,k).abort(),p(this,k,Z()),!s){p(this,w,null),this.fire("suggest",l(this,w));return}let c=T(this,B,Be).call(this);try{let i=yield this.search.suggest(s,b(a({sessionToken:c},r),{signal:l(this,k).signal}));p(this,w,i),this.fire("suggest",i)}catch(i){if(i.name==="AbortError")return;this.fire("suggesterror",i)}}),t,()=>l(this,k).signal)),Object.defineProperties(this,{search:{value:e,writable:!1},debounce:{value:t,writable:!1}})}get sessionToken(){return l(this,L)}set sessionToken(e){p(this,L,e),p(this,O,!0)}get suggestions(){return l(this,w)}suggest(e,t){return l(this,$).call(this,e,t),new Promise((s,r)=>{let o,g;o=c=>{this.removeEventListener("suggest",o),this.removeEventListener("suggesterror",g),s(c)},g=c=>{this.removeEventListener("suggest",o),this.removeEventListener("suggesterror",g),r(c)},this.addEventListener("suggest",o),this.addEventListener("suggesterror",g)})}clear(){this.suggest("")}retrieve(e,t){return d(this,null,function*(){let s=yield this.search.retrieve(e,a({sessionToken:l(this,L)},t));return l(this,O)||(p(this,L,new f),p(this,v,0)),this.fire("retrieve",s),s})}canRetrieve(e){return this.search.canRetrieve?this.search.canRetrieve(e):!0}canSuggest(e){return this.search.canSuggest?this.search.canSuggest(e):!0}abort(){l(this,k).abort(),p(this,k,Z())}};O=new WeakMap,L=new WeakMap,v=new WeakMap,B=new WeakSet,Be=function(){return l(this,O)||(l(this,L).isExpired()||l(this,v)>=Ge)&&(p(this,L,new f),p(this,v,0)),oe(this,v)._++,l(this,L)},w=new WeakMap,k=new WeakMap,$=new WeakMap;function ve(n){let{properties:e}=n;return a({},e)}module.exports=Ne(Ke);
//# sourceMappingURL=index.js.map
